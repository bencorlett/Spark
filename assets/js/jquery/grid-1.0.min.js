/**
 * Spark Fuel Package By Ben Corlett
 * 
 * Spark - Set your fuel on fire!
 * 
 * The Spark Fuel Package is an open-source
 * fuel package consisting of several 'widgets'
 * engineered to make developing various
 * web-based systems easier and quicker.
 * 
 * @package    Fuel
 * @subpackage Spark
 * @version    1.0
 * @author     Ben Corlett (http://www.bencorlett.com)
 * @license    MIT License
 * @copyright  (c) 2011 Ben Corlett
 * @link       http://spark.bencorlett.com
 */
(function(a){var b={init:function(b){var c={identifier:"grid",url:"",vars:{limit:"limit",page:"page",sort:"sort",direction:"direction",filters:"filters"},ajax:true,currentParams:{},showOverlay:true,fadeOverlaySpeed:"fast"};var d;d=this;if(b){a.extend(c,b)}if(typeof c.currentParams[c.vars.filters]==="undefined"){c.currentParams[c.vars.filters]={}}d.find("button.filters-reset").click(function(){d.find("form.filters-form").remove();d.append(a("<form></form>").css("display","none").addClass("filters-form"));d.find("tr.filters .filter").each(function(){a(this).val("")});d.trigger("update")});d.find("button.filters-apply").click(function(){d.trigger("reset-filters-form");d.find("tr.filters .filter").each(function(){if(a(this).val()){d.find("form.filters-form").append(a("<input></input>").attr("name",a(this).attr("name")).attr("value",a(this).attr("value")))}});d.data(c.vars.page,1);d.trigger("update")});d.find("tr.filters .filter").keypress(function(a){switch(a.keyCode){case 13:d.find("button.filters-apply").trigger("click");break}});d.bind("reset-filters-form",function(){d.find("form.filters-form").remove();d.append(a("<form></form>").css("display","none").addClass("filters-form"))});d.find("tr.headers span.header").click(function(){d.data(c.vars.sort,a(this).attr("column"));d.trigger("update")});d.find('tr.headers span.header-checkbox input[type="checkbox"]').change(function(){d.find('tbody tr input[type="checkbox"][name='+a(this).attr("targets")+"]")[a(this).attr("checked")?"attr":"removeAttr"]("checked","checked")});d.find(".pager input.page").keypress(function(b){switch(b.keyCode){case 13:a(this).trigger("update");break}});d.find(".pager input.page").bind("update",function(){d.data(c.vars.page,a(this).val());d.trigger("update")});d.find(".pager .previous").click(function(){d.find(".pager input.page").val(parseInt(d.find(".pager input.page").val())-1).trigger("update")});d.find(".pager .next").click(function(){d.find(".pager input.page").val(parseInt(d.find(".pager input.page").val())+1).trigger("update")});d.find(".pager .limit").change(function(){d.data(c.vars.limit,a(this).val());d.data(c.vars.page,1);d.trigger("update")});d.bind("update",function(){if(c.showOverlay){d.find("div.overlay").fadeIn(c.fadeOverlaySpeed)}if(d.find("form.filters-form").length>0){c.currentParams[c.vars.filters]=d.find("form.filters-form").formParams()}if(d.data(c.vars.sort)){if(c.currentParams[c.vars.sort]==d.data(c.vars.sort)&&c.currentParams[c.vars.direction]=="asc"){c.currentParams[c.vars.direction]="desc"}else c.currentParams[c.vars.direction]="asc";c.currentParams[c.vars.sort]=d.data(c.vars.sort)}if(d.data(c.vars.page)){c.currentParams[c.vars.page]=d.data(c.vars.page)}if(d.data(c.vars.limit)){c.currentParams[c.vars.limit]=d.data(c.vars.limit)}a.cookie("grid-"+c.identifier,JSON.stringify(c.currentParams));if(c.ajax){a.ajax({url:c.url,data:{grid_identifier:c.identifier},success:function(a,b,e){if(c.showOverlay){d.find("div.overlay").fadeOut(c.showOverlaySpeed,function(){d.replaceWith(a)})}else{d.replaceWith(a)}},error:function(a,b,c){d.find("div.overlay").fadeOut("fast")}})}else{window.location.href=c.url}})}};a.fn.sparkGrid=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist in jQuery.sparkGrid")}}})(jQuery);(function(a){var b=/radio|checkbox/i,c=/[^\[\]]+/g,d=/^[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?$/;var e=function(a){if(typeof a=="number"){return true}if(typeof a!="string"){return false}return a.match(d)};a.fn.extend({formParams:function(a){if(this[0].nodeName.toLowerCase()=="form"&&this[0].elements){return jQuery(jQuery.makeArray(this[0].elements)).getParams(a)}return jQuery("input[name], textarea[name], select[name]",this[0]).getParams(a)},getParams:function(d){var f={},g;d=d===undefined?true:d;this.each(function(){var h=this,i=h.type&&h.type.toLowerCase();if(i=="submit"||!h.name){return}var j=h.name,k=a.data(h,"value")||a.fn.val.call([h]),l=b.test(h.type),m=j.match(c),n=!l||!!h.checked,o;if(d){if(e(k)){k=parseFloat(k)}else if(k==="true"||k==="false"){k=Boolean(k)}}g=f;for(var p=0;p<m.length-1;p++){if(!g[m[p]]){g[m[p]]={}}g=g[m[p]]}o=m[m.length-1];if(o in g&&i==="checkbox"){if(!a.isArray(g[o])){g[o]=g[o]===undefined?[]:[g[o]]}if(n){g[o].push(k)}}else if(n||!g[o]){g[o]=n?k:undefined}});return f}})})(jQuery);jQuery.cookie=function(a,b,c){if(arguments.length>1&&String(b)!=="[object Object]"){c=jQuery.extend({},c);if(b===null||b===undefined){c.expires=-1}if(typeof c.expires==="number"){var d=c.expires,e=c.expires=new Date;e.setDate(e.getDate()+d)}b=String(b);return document.cookie=[encodeURIComponent(a),"=",c.raw?b:encodeURIComponent(b),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=b||{};var f,g=c.raw?function(a){return a}:decodeURIComponent;return(f=(new RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)")).exec(document.cookie))?g(f[1]):null}